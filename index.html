<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Cash Collection</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    body { padding: 20px; }
    .event-card { margin-bottom: 20px; }
    .totals-row { font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>

<div class="container">
  <h2 class="mb-4">Event Cash Collection</h2>
  
  <form id="cashForm">
    <div id="events"></div>
    <button type="button" class="btn btn-secondary mb-3" id="addEventBtn">+ Add Another Event</button>
    <br>
    <button type="submit" class="btn btn-primary">Submit All Events</button>
  </form>
</div>

<script>
let eventCount = 0;

const coinValues = {
  nickels: 0.05,
  dimes: 0.10,
  quarters: 0.25,
  loonies: 1,
  toonies: 2
};

const billValues = {
  fives: 5,
  tens: 10,
  twenties: 20,
  fifties: 50,
  hundreds: 100
};

function todayDate() {
  return new Date().toISOString().split("T")[0];
}

// Add new event card
function addEvent() {
  eventCount++;
  const id = eventCount;

  const eventHtml = `
    <div class="card event-card" id="event-${id}">
      <div class="card-body">
        <div class="d-flex justify-content-between mb-3">
          <h5 class="card-title">Event ${id}</h5>
          <div>
            <button type="button" class="btn btn-sm btn-warning me-2" onclick="clearEvent(${id})">Clear</button>
            <button type="button" class="btn btn-sm btn-danger" onclick="removeEvent(${id})">Remove</button>
          </div>
        </div>

        <!-- Row 1: Event name + Date -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Event Name</label>
            <select class="form-select" name="eventName-${id}">
              <option value="Admission">Admission</option>
              <option value="50/50">50/50</option>
              <option value="Apparel">Apparel</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">Date</label>
            <input type="date" class="form-control" name="date-${id}" value="${todayDate()}">
          </div>
        </div>

        <!-- Row 2: Coins (left) + Bills (right) -->
        <div class="row mb-3">
          <div class="col-md-6">
            <h6>Coins</h6>
            ${Object.keys(coinValues).map(k => `
              <div class="input-group mb-2">
                <span class="input-group-text text-capitalize">${k}</span>
                <input type="number" class="form-control coin-input" name="${k}-${id}" value="0" min="0">
              </div>
            `).join('')}
            <div class="fw-bold">Total Coins: $<span id="coinTotal-${id}">0.00</span></div>
          </div>
          <div class="col-md-6">
            <h6>Bills</h6>
            ${Object.keys(billValues).map(k => `
              <div class="input-group mb-2">
                <span class="input-group-text text-capitalize">$${billValues[k]}</span>
                <input type="number" class="form-control bill-input" name="${k}-${id}" value="0" min="0">
              </div>
            `).join('')}
            <div class="fw-bold">Total Bills: $<span id="billTotal-${id}">0.00</span></div>
          </div>
        </div>

        <!-- Totals -->
        <div class="totals-row">Total Cash: $<span id="cashTotal-${id}">0.00</span></div>
        <div class="totals-row">EMT: 
          <input type="number" step="0.01" class="form-control d-inline-block w-auto ms-2 emt-input" 
                 name="emt-${id}" value="0">
        </div>
        <div class="totals-row">Overall Total: $<span id="overallTotal-${id}">0.00</span></div>
      </div>
    </div>
  `;
  $("#events").append(eventHtml);
}

// Update totals
function updateTotals(id) {
  let coinTotal = 0, billTotal = 0;

  $.each(coinValues, function(k, val) {
    const qty = parseInt($(`[name='${k}-${id}']`).val()) || 0;
    coinTotal += qty * val;
  });

  $.each(billValues, function(k, val) {
    const qty = parseInt($(`[name='${k}-${id}']`).val()) || 0;
    billTotal += qty * val;
  });

  const emt = parseFloat($(`[name='emt-${id}']`).val()) || 0;
  const cashTotal = coinTotal + billTotal;

  $(`#coinTotal-${id}`).text(coinTotal.toFixed(2));
  $(`#billTotal-${id}`).text(billTotal.toFixed(2));
  $(`#cashTotal-${id}`).text(cashTotal.toFixed(2));
  $(`#overallTotal-${id}`).text((cashTotal + emt).toFixed(2));
}

// Clear an eventâ€™s inputs
function clearEvent(id) {
  $(`#event-${id} input[type='number']`).val(0);
  $(`#event-${id} input[type='date']`).val(todayDate());
  updateTotals(id);
}

// Remove an event entirely
function removeEvent(id) {
  $(`#event-${id}`).remove();
}

// Listen for changes
$(document).on("input", ".coin-input, .bill-input, .emt-input", function() {
  const id = $(this).attr("name").split("-")[1];
  updateTotals(id);
});

// Init
$(document).ready(function() {
  addEvent();
});

// Add another event
$("#addEventBtn").click(function() {
  addEvent();
});

// Submit form
$("#cashForm").submit(function(e) {
  e.preventDefault();

  let events = [];

  $(".event-card").each(function() {
    const id = this.id.split("-")[1];
    let values = {};

    values.eventName = $(`[name='eventName-${id}']`).val();
    values.date = $(`[name='date-${id}']`).val();

    $.each(coinValues, function(k) {
      values[k] = parseInt($(`[name='${k}-${id}']`).val()) || 0;
    });
    $.each(billValues, function(k) {
      values[k] = parseInt($(`[name='${k}-${id}']`).val()) || 0;
    });

    values.emt = parseFloat($(`[name='emt-${id}']`).val()) || 0;

    // Calculate totals
    let coinTotal = 0, billTotal = 0;
    $.each(coinValues, (k,v) => coinTotal += values[k] * v);
    $.each(billValues, (k,v) => billTotal += values[k] * v);
    let cashTotal = coinTotal + billTotal;

    values.coinTotal = coinTotal.toFixed(2);
    values.billTotal = billTotal.toFixed(2);
    values.cashTotal = cashTotal.toFixed(2);
    values.overallTotal = (cashTotal + values.emt).toFixed(2);

    events.push(values);
  });

  // Submit to Google Apps Script
  fetch("YOUR_GOOGLE_SCRIPT_WEBAPP_URL", {
    method: "POST",
    mode: "no-cors",
    body: JSON.stringify({ events: events })
  }).then(() => {
    alert("Submission saved to Google Sheet!");
    $("#cashForm")[0].reset();
    $("#events").empty();
    eventCount = 0;
    addEvent(); // reset with one fresh event
  });
});
</script>

</body>
</html>
