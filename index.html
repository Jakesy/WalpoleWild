<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Cash Collection</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    body { padding: 20px; }
    .event-card { margin-bottom: 20px; }
  </style>
</head>
<body>

<div class="container">
  <h2 class="mb-4">Event Cash Collection</h2>
  
  <form id="cashForm">
    <div id="events"></div>
    <button type="button" class="btn btn-secondary mb-3" id="addEventBtn">+ Add Another Event</button>
    <br>
    <button type="submit" class="btn btn-primary">Submit All Events</button>
  </form>
</div>

<script>
let eventCount = 0;

// Currency values
const currencyValues = {
  nickels: 0.05,
  dimes: 0.10,
  quarters: 0.25,
  loonies: 1,
  toonies: 2,
  fives: 5,
  tens: 10,
  twenties: 20,
  fifties: 50,
  hundreds: 100
};

// Add a new event form
function addEvent() {
  eventCount++;
  const eventHtml = `
    <div class="card event-card" id="event-${eventCount}">
      <div class="card-body">
        <h5 class="card-title">Event ${eventCount}</h5>
        <div class="row g-2">
          ${Object.keys(currencyValues).map(key => `
            <div class="col-md-3">
              <label class="form-label text-capitalize">${key}</label>
              <input type="number" class="form-control currency-input" name="${key}-${eventCount}" value="0" min="0">
            </div>
          `).join('')}
          <div class="col-md-3">
            <label class="form-label">EMT</label>
            <input type="number" step="0.01" class="form-control emt-input" name="emt-${eventCount}" value="0">
          </div>
        </div>
        <div class="mt-3 fw-bold">
          Total Cash: $<span id="cashTotal-${eventCount}">0.00</span><br>
          Overall Total: $<span id="overallTotal-${eventCount}">0.00</span>
        </div>
      </div>
    </div>`;
  $("#events").append(eventHtml);
}

// Update totals when inputs change
function updateTotals(eventId) {
  let cashTotal = 0;

  $.each(currencyValues, function(key, val) {
    const qty = parseInt($(`[name='${key}-${eventId}']`).val()) || 0;
    cashTotal += qty * val;
  });

  const emt = parseFloat($(`[name='emt-${eventId}']`).val()) || 0;

  $(`#cashTotal-${eventId}`).text(cashTotal.toFixed(2));
  $(`#overallTotal-${eventId}`).text((cashTotal + emt).toFixed(2));
}

// Handle dynamic updates
$(document).on("input", ".currency-input, .emt-input", function() {
  const name = $(this).attr("name");
  const eventId = name.split("-")[1];
  updateTotals(eventId);
});

// Add first event on load
$(document).ready(function() {
  addEvent();
});

// Add another event button
$("#addEventBtn").click(function() {
  addEvent();
});

// Handle form submit
$("#cashForm").submit(function(e) {
  e.preventDefault();

  let events = [];

  for (let i = 1; i <= eventCount; i++) {
    let values = {};
    $.each(currencyValues, function(key, val) {
      values[key] = parseInt($(`[name='${key}-${i}']`).val()) || 0;
    });
    values.emt = parseFloat($(`[name='emt-${i}']`).val()) || 0;

    let cashTotal = 0;
    $.each(currencyValues, function(key, val) {
      cashTotal += values[key] * val;
    });

    values.cashTotal = cashTotal.toFixed(2);
    values.overallTotal = (cashTotal + values.emt).toFixed(2);

    events.push(values);
  }

  // Submit to Google Apps Script
  fetch("YOUR_GOOGLE_SCRIPT_WEBAPP_URL", {
    method: "POST",
    mode: "no-cors", // Google Apps Script requires no-cors
    body: JSON.stringify({ events: events })
  }).then(() => {
    alert("Submission saved to Google Sheet!");
    $("#cashForm")[0].reset();
    $("#events").empty();
    eventCount = 0;
    addEvent(); // start fresh
  });
});
</script>

</body>
</html>
