<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Cash Entry</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    .event-card { margin-bottom: 20px; }
    .remove-btn { float: right; }
    .totals-row { font-weight: bold; }
	.input-group-text { min-width: 85px; justify-content: end; }	
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2 class="mb-4">Event Cash Entry</h2>
    <form id="cashForm">
      <div id="events"></div>
      <button type="button" class="btn btn-primary mb-3" id="addEvent">+ Add Another Event</button>
      <br>
      <button type="submit" class="btn btn-success">Submit All</button>
    </form>
  </div>

  <script>
    let eventCount = 0;

    function addEvent() {
      eventCount++;
      const today = new Date().toISOString().split('T')[0];

      const eventHtml = `
        <div class="card event-card" data-event="${eventCount}">
          <div class="card-body">
            <button type="button" class="btn btn-sm btn-danger remove-btn">Remove Event</button>
            <h5 class="card-title">Event ${eventCount}</h5>
            
            <!-- Row 1: Event Name + Date -->
            <div class="row mb-3">
              <div class="col-md-3">
                <select class="form-select event-name">
                  <option>Admission</option>
                  <option>50/50</option>
                  <option>Apparel</option>
                  <option>Other</option>
                </select>
              </div>
              <div class="col-md-3">
                <input type="date" class="form-control event-date" value="${today}">
              </div>
            </div>

            <!-- Row 2: Coins + Bills -->
            <div class="row mb-3">
              <div class="col-md-3">
                <label class="form-label">Coins</label>
                <div class="input-group mb-1"><span class="input-group-text">Nickels</span><input type="number" class="form-control nickels" min="0" placeholder="0"></div>
                <div class="input-group mb-1"><span class="input-group-text">Dimes</span><input type="number" class="form-control dimes" min="0" placeholder="0"></div>
                <div class="input-group mb-1"><span class="input-group-text">Quarters</span><input type="number" class="form-control quarters" min="0" placeholder="0"></div>
                <div class="input-group mb-1"><span class="input-group-text">Loonies</span><input type="number" class="form-control loonies" min="0" placeholder="0"></div>
                <div class="input-group mb-1"><span class="input-group-text">Toonies</span><input type="number" class="form-control toonies" min="0" placeholder="0"></div>
                <div class="mt-2"><strong>Total Coins: $<span class="total-coins">0.00</span></strong></div>
              </div>
              <div class="col-md-3">
                <label class="form-label">Bills</label>
                <div class="input-group mb-1"><span class="input-group-text">$5</span><input type="number" class="form-control fives" min="0" placeholder="0"></div>
                <div class="input-group mb-1"><span class="input-group-text">$10</span><input type="number" class="form-control tens" min="0" placeholder="0"></div>
                <div class="input-group mb-1"><span class="input-group-text">$20</span><input type="number" class="form-control twenties" min="0" placeholder="0"></div>
                <div class="input-group mb-1"><span class="input-group-text">$50</span><input type="number" class="form-control fifties" min="0" placeholder="0"></div>
                <div class="input-group mb-1"><span class="input-group-text">$100</span><input type="number" class="form-control hundreds" min="0" placeholder="0"></div>
                <div class="mt-2"><strong>Total Bills: $<span class="total-bills">0.00</span></strong></div>
              </div>
            </div>

            <!-- Totals -->
            <div class="mb-2 totals-row">Total Cash: $<span class="total-cash">0.00</span></div>
			
			<div class="row mb-3">
				<div class="col-md-3">
					<div class="input-group mb-1"><span class="input-group-text">EMT</span><input type="number" class="form-control emt" min="0" placeholder="0"></div>			
				</div>	
			</div>
            <div class="mb-2 totals-row">Overall Total: $<span class="total-overall">0.00</span></div>

            <!-- Buttons -->
            <button type="button" class="btn btn-warning btn-sm clear-event">Clear Values</button>
          </div>
        </div>
      `;

      $("#events").append(eventHtml);
      attachEventHandlers($(`.event-card[data-event="${eventCount}"]`));
    }

    function attachEventHandlers(card) {
      function recalc() {
        const nickels = parseInt(card.find(".nickels").val() || 0) * 0.05;
        const dimes = parseInt(card.find(".dimes").val() || 0) * 0.10;
        const quarters = parseInt(card.find(".quarters").val() || 0) * 0.25;
        const loonies = parseInt(card.find(".loonies").val() || 0) * 1.00;
        const toonies = parseInt(card.find(".toonies").val() || 0) * 2.00;
        const totalCoins = nickels + dimes + quarters + loonies + toonies;

        const fives = parseInt(card.find(".fives").val() || 0) * 5;
        const tens = parseInt(card.find(".tens").val() || 0) * 10;
        const twenties = parseInt(card.find(".twenties").val() || 0) * 20;
        const fifties = parseInt(card.find(".fifties").val() || 0) * 50;
        const hundreds = parseInt(card.find(".hundreds").val() || 0) * 100;
        const totalBills = fives + tens + twenties + fifties + hundreds;

        const totalCash = totalCoins + totalBills;
        const emt = parseFloat(card.find(".emt").val()) || 0;
        const overall = totalCash + emt;

        card.find(".total-coins").text(totalCoins.toFixed(2));
        card.find(".total-bills").text(totalBills.toFixed(2));
        card.find(".total-cash").text(totalCash.toFixed(2));
        card.find(".total-overall").text(overall.toFixed(2));
      }

      card.find("input").on("input", recalc);

      card.find(".clear-event").on("click", function() {
        card.find("input").val(0);
        recalc();
      });
	  
	  card.find(".form-select").on("change", function() {
		card.find(".card-title").text("Event " + $(this).find("option:selected").text());
	  }).trigger("change");

      card.find(".remove-btn").on("click", function() {
        card.remove();
      });

      recalc();
    }

    $("#addEvent").on("click", addEvent);

    $("#cashForm").on("submit", function(e) {
      e.preventDefault();
      const events = [];
      $(".event-card").each(function() {
        const card = $(this);
        events.push({
          eventName: card.find(".event-name").val(),
          date: card.find(".event-date").val(),
          nickels: parseInt(card.find(".nickels").val()) || 0,
          dimes: parseInt(card.find(".dimes").val()) || 0,
          quarters: parseInt(card.find(".quarters").val()) || 0,
          loonies: parseInt(card.find(".loonies").val()) || 0,
          toonies: parseInt(card.find(".toonies").val()) || 0,
          fives: parseInt(card.find(".fives").val()) || 0,
          tens: parseInt(card.find(".tens").val()) || 0,
          twenties: parseInt(card.find(".twenties").val()) || 0,
          fifties: parseInt(card.find(".fifties").val()) || 0,
          hundreds: parseInt(card.find(".hundreds").val()) || 0,
          cashTotal: parseFloat(card.find(".total-cash").text()),
          emt: parseFloat(card.find(".emt").val()) || 0,
          overallTotal: parseFloat(card.find(".total-overall").text())
        });
      });

      // ðŸ”— Replace with your actual Google Apps Script URL
      fetch("YOUR_GOOGLE_SCRIPT_WEBAPP_URL", {
        method: "POST",
        mode: "no-cors",
        body: JSON.stringify({ events: events })
      }).then(() => {
        alert("Submission saved!");
        $("#events").empty();
        eventCount = 0;
        addEvent();
      });
    });

    // Start with one event
    addEvent();
  </script>
</body>
</html>
